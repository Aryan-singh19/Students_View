<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theory of Computation - Course Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0f0f0f;
            --bg-panel: #1e1e1e;
            --bg-hover: #303030;
            --text-main: #ffffff;
            --text-mute: #aaaaaa;
            --brand: #ff0000;
            --success: #2ba640;
            --border: #333;
        }

        * { box-sizing: border-box; }
        body { font-family: 'Roboto', sans-serif; background-color: var(--bg-dark); color: var(--text-main); margin: 0; overflow-x: hidden; }

        /* HEADER */
        header {
            background: rgba(15, 15, 15, 0.98);
            padding: 12px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border);
        }
        .logo { display: flex; align-items: center; gap: 8px; font-weight: 700; font-size: 1.2rem; letter-spacing: -0.5px; }
        .logo svg { height: 24px; fill: var(--brand); }
        .user-pill { background: #3ea6ff; color: #000; padding: 4px 12px; border-radius: 18px; font-size: 0.8rem; font-weight: 600; }

        /* LAYOUT */
        .grid-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 24px;
            padding: 24px;
            max-width: 1800px;
            margin: 0 auto;
            height: calc(100vh - 60px);
        }

        /* VIDEO PLAYER */
        .main-col { display: flex; flex-direction: column; overflow-y: auto; padding-right: 10px; }
        .player-wrapper {
            position: relative;
            padding-bottom: 56.25%;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .player-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        /* OVERLAYS */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .overlay h2 { color: var(--brand); margin-bottom: 10px; }
        .btn {
            background: #3ea6ff; color: #0f0f0f; border: none; padding: 10px 24px;
            font-weight: 600; border-radius: 2px; cursor: pointer; text-transform: uppercase;
        }
        .btn:hover { background: #65b8ff; }

        /* INFO AREA */
        .info-area { margin-top: 16px; border-bottom: 1px solid var(--border); padding-bottom: 16px; }
        h1.video-title { font-size: 1.25rem; margin: 0 0 8px 0; font-weight: 600; }
        .video-stats { display: flex; justify-content: space-between; color: var(--text-mute); font-size: 0.9rem; }

        /* TABS */
        .tabs { display: flex; gap: 20px; margin-top: 16px; }
        .tab {
            background: none; border: none; color: var(--text-mute);
            font-size: 1rem; font-weight: 500; padding: 0 0 10px 0;
            cursor: pointer; position: relative;
        }
        .tab.active { color: var(--text-main); }
        .tab.active::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: var(--text-main); border-radius: 3px 3px 0 0;
        }

        /* ANALYTICS PANEL */
        .panel { display: none; margin-top: 20px; background: var(--bg-panel); padding: 20px; border-radius: 12px; }
        .panel.show { display: block; }
        
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .stat-card { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; text-align: center; }
        .big-num { font-size: 2.5rem; font-weight: 700; color: var(--brand); }
        
        .download-btn {
            background: var(--bg-hover); color: var(--text-main);
            width: 100%; padding: 15px; border: 1px solid var(--border);
            border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            font-size: 1rem; font-weight: 600;
        }
        .download-btn:hover { background: #444; }

        /* SIDEBAR PLAYLIST */
        .sidebar {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 12px;
            display: flex; flex-direction: column;
            overflow: hidden;
            height: 100%;
        }
        .playlist-head { padding: 16px; border-bottom: 1px solid var(--border); font-weight: 700; display: flex; justify-content: space-between; }
        .playlist-scroll { overflow-y: auto; flex: 1; }
        
        .playlist-item {
            display: flex; gap: 10px; padding: 10px; cursor: pointer;
            border-bottom: 1px solid transparent; transition: background 0.2s;
        }
        .playlist-item:hover { background: var(--bg-hover); }
        .playlist-item.active { background: #303030; border-left: 4px solid var(--brand); }

        .thumb {
            width: 100px; height: 56px; background: #000; border-radius: 8px; 
            position: relative; display: flex; align-items: center; justify-content: center;
            overflow: hidden; flex-shrink: 0;
        }
        .thumb-txt { color: #555; font-size: 1.5rem; }
        .progress-overlay {
            position: absolute; bottom: 0; left: 0; height: 4px; background: var(--brand); width: 0%;
        }
        .completed .progress-overlay { background: var(--success); }

        .meta { display: flex; flex-direction: column; justify-content: center; min-width: 0; }
        .meta-title { font-size: 0.9rem; font-weight: 500; margin-bottom: 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .meta-sub { font-size: 0.75rem; color: var(--text-mute); }

        /* Responsive */
        @media(max-width: 1000px) {
            .grid-container { grid-template-columns: 1fr; height: auto; }
            .sidebar { height: 500px; }
        }
    </style>
</head>
<body>

<header>
    <div class="logo">
        <svg viewBox="0 0 24 24"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/></svg>
        CourseTube
    </div>
    <div class="user-pill">Student View</div>
</header>

<div class="grid-container">
    
    <!-- LEFT: Player & Analytics -->
    <div class="main-col">
        
        <div class="player-wrapper">
            <div id="player"></div>
            <!-- Anti-Cheat Overlay -->
            <div class="overlay" id="cheat-screen">
                <h2>‚ö†Ô∏è Playback Paused</h2>
                <p style="color:#ddd; margin-bottom: 20px;">Window focus lost. Please stay on this tab.</p>
                <button class="btn" onclick="resume()">Resume Playback</button>
            </div>
        </div>

        <div class="info-area">
            <h1 class="video-title" id="main-title">Loading Course...</h1>
            <div class="video-stats">
                <span id="video-count-display">Video 1 / 19</span>
                <span id="main-percent">0% Watched</span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="setTab('desc')">Overview</button>
            <button class="tab" onclick="setTab('analytics')">üìä Analytics & Download</button>
        </div>

        <!-- Tab 1 -->
        <div id="tab-desc" class="panel show">
            <p style="color:var(--text-mute); line-height: 1.6;">
                Welcome to the <b>Theory of Computation</b> playlist. 
                This tracker automatically saves your progress. Do not skip segments.
            </p>
        </div>

        <!-- Tab 2 -->
        <div id="tab-analytics" class="panel">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="big-num" id="total-stat">0%</div>
                    <div style="color:var(--text-mute); font-size:0.8rem;">COURSE COMPLETION</div>
                </div>
                <div class="stat-card">
                    <div class="big-num" id="watched-stat">0</div>
                    <div style="color:var(--text-mute); font-size:0.8rem;">VIDEOS FINISHED</div>
                </div>
            </div>
            
            <button class="download-btn" onclick="downloadReport()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                Download Progress Report (.txt)
            </button>
        </div>

    </div>

    <!-- RIGHT: Playlist -->
    <div class="sidebar">
        <div class="playlist-head">
            <span>Theory of Computation</span>
            <span style="color:var(--text-mute); font-weight:400;">Learning Lab</span>
        </div>
        <div class="playlist-scroll" id="playlist-container">
            <!-- Items injected via JS -->
        </div>
    </div>

</div>

<script>
    // --- CONFIG ---
    const PLAYLIST_ID = 'PL424dCM7s48ngY-ylr6rKDhZC-eojZyOT';
    const STORAGE_KEY = 'toc_tracker_final';

    // THE LIST YOU PROVIDED (Cleaned up)
    const VIDEOS = [
        "01 Intro to Grammar & Recursively Enumerable",
        "02 Language Generated by Grammar (Ex 1)",
        "03 Language Generated by Grammar (Ex 2)",
        "04 Language Generated by Grammar (Ex 3)",
        "05 RLG to LLG 1",
        "06 LLG to RLG",
        "07 Elimination of Useless Symbols (TOC)",
        "08 Context Free Grammar",
        "09 Push Down Automata",
        "10 Practice Questions PDA and NPDA",
        "11 Conversion of CFG to PDA",
        "12 Turing Machine",
        "13 Turing Machine: Practice Questions",
        "14 Intro to Recursively Enumerable Sets",
        "15 Undecidability & Comp. Classes",
        "16 Universal Turing Machine",
        "17 Computational Classes",
        "18 Sequence Detector (Moore & Mealy)",
        "19 Master PDA to CFG Conversion"
    ];

    // --- STATE ---
    var player, timer;
    var currentIndex = -1;
    var currentDuration = 0;
    var progress = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

    // --- SETUP ---
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '100%', width: '100%',
            playerVars: { listType: 'playlist', list: PLAYLIST_ID, rel: 0, modestbranding: 1 },
            events: {
                'onReady': initApp,
                'onStateChange': onStateChange
            }
        });
    }

    function initApp() {
        renderSidebar();
        updateAnalytics();
    }

    function onStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING) {
            detectVideoChange();
            startTracking();
            document.getElementById('cheat-screen').style.display = 'none';
        } else if (event.data == YT.PlayerState.CUED) {
            renderSidebar();
        } else {
            stopTracking();
        }
    }

    // --- CORE TRACKING ---
    function detectVideoChange() {
        let idx = player.getPlaylistIndex();
        
        // Sync Sidebar Selection
        document.querySelectorAll('.playlist-item').forEach(e => e.classList.remove('active'));
        let activeEl = document.getElementById(`item-${idx}`);
        if(activeEl) {
            activeEl.classList.add('active');
            activeEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        if (idx !== currentIndex || currentDuration === 0) {
            currentIndex = idx;
            currentDuration = Math.floor(player.getDuration());
            
            // Init Memory
            if (!progress[currentIndex]) progress[currentIndex] = new Array(currentDuration).fill(0);
            else if (progress[currentIndex].length < currentDuration) {
                // Resize array if needed
                let old = progress[currentIndex];
                progress[currentIndex] = new Array(currentDuration).fill(0);
                for(let i=0; i<old.length; i++) progress[currentIndex][i] = old[i];
            }
            
            updateMainInfo();
        }
    }

    function startTracking() {
        clearInterval(timer);
        timer = setInterval(() => {
            let t = Math.floor(player.getCurrentTime());
            if (progress[currentIndex] && t < progress[currentIndex].length) {
                progress[currentIndex][t] = 1;
                
                if (t % 2 === 0) {
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
                    updateUIRealTime();
                }
            }
        }, 1000);
    }

    function stopTracking() {
        clearInterval(timer);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        updateAnalytics();
    }

    // --- UI RENDERING ---
    function renderSidebar() {
        const list = document.getElementById('playlist-container');
        list.innerHTML = '';
        
        VIDEOS.forEach((title, i) => {
            let el = document.createElement('div');
            el.className = 'playlist-item';
            el.id = `item-${i}`;
            el.onclick = () => player.playVideoAt(i);
            
            let pct = getPct(i);
            let isDone = pct > 95;
            
            el.innerHTML = `
                <div class="thumb ${isDone?'completed':''}">
                    <span class="thumb-txt">‚ñ∂</span>
                    <div class="progress-overlay" style="width:${pct}%" id="bar-${i}"></div>
                </div>
                <div class="meta">
                    <div class="meta-title">${i+1}. ${title}</div>
                    <div class="meta-sub" id="sub-${i}">${pct}% Watched</div>
                </div>
            `;
            list.appendChild(el);
        });
    }

    function updateMainInfo() {
        let title = VIDEOS[currentIndex] || `Video ${currentIndex+1}`;
        document.getElementById('main-title').innerText = title;
        document.getElementById('video-count-display').innerText = `Video ${currentIndex + 1} of ${VIDEOS.length}`;
    }

    function updateUIRealTime() {
        let pct = getPct(currentIndex);
        document.getElementById('main-percent').innerText = `${pct}% Watched`;
        
        // Update Sidebar Bar
        let bar = document.getElementById(`bar-${currentIndex}`);
        let sub = document.getElementById(`sub-${currentIndex}`);
        if(bar) bar.style.width = `${pct}%`;
        if(sub) sub.innerText = `${pct}% Watched`;
    }

    function updateAnalytics() {
        let totalSum = 0;
        let completedCount = 0;
        
        VIDEOS.forEach((_, i) => {
            let p = parseFloat(getPct(i));
            totalSum += p;
            if(p > 95) completedCount++;
        });

        let totalAvg = (totalSum / VIDEOS.length).toFixed(1);
        document.getElementById('total-stat').innerText = `${totalAvg}%`;
        document.getElementById('watched-stat').innerText = `${completedCount} / ${VIDEOS.length}`;
    }

    function getPct(i) {
        if(!progress[i]) return 0;
        let watched = progress[i].filter(x => x===1).length;
        let total = progress[i].length;
        return total === 0 ? 0 : ((watched/total)*100).toFixed(0);
    }

    // --- UTILS ---
    window.setTab = function(t) {
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('show'));
        document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
        
        document.getElementById(`tab-${t}`).classList.add('show');
        event.target.classList.add('active');
        
        if(t === 'analytics') updateAnalytics();
    }

    window.resume = function() {
        document.getElementById('cheat-screen').style.display = 'none';
        player.playVideo();
    }

    window.downloadReport = function() {
        let txt = "THEORY OF COMPUTATION - PROGRESS REPORT\n";
        txt += "---------------------------------------\n";
        txt += `Date: ${new Date().toLocaleString()}\n`;
        txt += `Total Completion: ${document.getElementById('total-stat').innerText}\n\n`;
        
        VIDEOS.forEach((title, i) => {
            let p = getPct(i);
            let status = p > 95 ? "[x] COMPLETED" : "[ ] IN PROGRESS";
            txt += `${status} | ${p}% | ${title}\n`;
        });

        let blob = new Blob([txt], { type: "text/plain" });
        let url = URL.createObjectURL(blob);
        let a = document.createElement('a');
        a.href = url;
        a.download = "TOC_Progress_Report.txt";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    // Anti-Cheat
    document.addEventListener("visibilitychange", function() {
        if (document.hidden && player && player.getPlayerState() === 1) {
            player.pauseVideo();
            document.getElementById('cheat-screen').style.display = 'flex';
        }
    });

</script>

</body>
</html>



