<!DOCTYPE html>
<html>
<head>
    <title>Admin - Force Verify & Boost</title>
    <style>
        body { background: #050505; color: #fff; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .admin-card { border: 1px solid #ff4081; padding: 30px; border-radius: 15px; background: #111; text-align: center; width: 400px; box-shadow: 0 0 25px rgba(255, 64, 129, 0.4); }
        .pct-display { font-size: 3.5rem; font-weight: bold; color: #ff4081; margin: 10px 0; }
        input[type="range"] { width: 100%; accent-color: #ff4081; margin: 20px 0; cursor: pointer; }
        button { background: #ff4081; color: white; border: none; padding: 14px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; transition: 0.3s; }
        button:hover { background: #f50057; }
        .verification-box { margin-top: 20px; background: #000; padding: 15px; border-radius: 10px; border: 1px solid #333; text-align: left; }
        .status-tag { color: #00ff00; font-weight: bold; font-size: 0.8rem; }
    </style>
</head>
<body>

<div class="admin-card">
    <h2 style="margin:0;">Target: Khushee Singh</h2>
    <p style="font-size: 0.8rem; color: #777;">singhkhushee99@gmail.com</p>
    
    <div class="pct-display" id="pctText">50%</div>
    <input type="range" id="pctSlide" min="10" max="90" value="50" oninput="document.getElementById('pctText').innerText = this.value + '%'">
    
    <button onclick="applyBoost()">ðŸš€ Inject & Force Sync</button>

    <div class="verification-box">
        <div style="font-size: 0.9rem; margin-bottom: 5px;">Cloud Status: <span id="cloudStatus">Unknown</span></div>
        <div id="dataVerify" style="font-size: 0.75rem; color: #888;">No data fetched yet.</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs, doc, updateDoc, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

    const firebaseConfig = { 
        apiKey: "AIzaSyByqcto5JMr3BWJyemb9Q2XLi8OSBRfaTw", 
        authDomain: "students-view.firebaseapp.com", 
        projectId: "students-view" 
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const targetEmail = "singhkhushee99@gmail.com";

    // REAL-TIME VERIFICATION
    // This watches her record and calculates the % from the raw arrays
    const q = query(collection(db, "user_progress"), where("email", "==", targetEmail));
    getDocs(q).then(snap => {
        if(!snap.empty) {
            onSnapshot(doc(db, "user_progress", snap.docs[0].id), (s) => {
                const d = s.data();
                const progress = d.progress || {};
                
                // Manual calculation from raw data
                let totalSlots = 0;
                let watchedSlots = 0;
                Object.values(progress).forEach(arr => {
                    if(Array.isArray(arr)) {
                        totalSlots += arr.length;
                        watchedSlots += arr.filter(x => x === 1).length;
                    }
                });

                const currentCloudPct = totalSlots > 0 ? ((watchedSlots / totalSlots) * 100).toFixed(1) : 0;
                document.getElementById('cloudStatus').innerHTML = `<span class="status-tag">${currentCloudPct}% Injected</span>`;
                document.getElementById('dataVerify').innerText = `Total Seconds Watched: ${watchedSlots}`;
            });
        }
    });

    window.applyBoost = async () => {
        const pct = parseInt(document.getElementById('pctSlide').value);
        const snap = await getDocs(q);
        if (snap.empty) return alert("Khushee not found!");

        const mockProgress = {};
        const totalVids = 20; 
        const vidsToFill = Math.floor(totalVids * (pct / 100));

        for(let i=0; i < totalVids; i++) {
            // Fills 10 minutes (600 seconds) for each video
            mockProgress[i] = (i < vidsToFill) ? new Array(600).fill(1) : new Array(600).fill(0);
        }

        await updateDoc(doc(db, "user_progress", snap.docs[0].id), {
            progress: mockProgress,
            name: "Khushee Singh",
            lastUpdated: serverTimestamp(),
            // Adding a forced status update for the dashboard
            lastActive: "System Sync" 
        });

        alert("Injection Triggered! Watch the Cloud Status box below to verify.");
    };
</script>
</body>
</html>
